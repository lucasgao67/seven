[toc]



# 名词解释

实体：

- 这个概念是为了方便在整个上下文边界区分某一类对象而引入的概念。
- 拥有唯一的标志符

值对象

- 可以理解为实体的某些属性的集合
- 无ID，不可变，无生命周期，用完即扔。
- 核心本质是值，是一组概念完整的属性组成的集合。

实体vs值对象

1. 实体一般对应业务对象，它具有业务属性和业务行为。而值对象主要是属性集合，对实体的状态和特征进行描述。
2. 值对象可以理解为实体某些属性的集合。在设计的时候，为了防止实体属性太过零散，可以根据属性特征将其设计为值对象。值对象一般唯一标志符，其被实体整体引用。做了实体一部分出现，更进一步，值对象的属性就是实体的属性。



聚合：

- 由业务和逻辑紧密关联的实体和值对象组合而成。
- 是数据修改和持久化的基本单元（最小单位？）



聚合根：

- 实体的一种，具有实体的属性和业务行为
- 做为聚合的管理者，负责协调实体和值对象按照固定的业务规则协同完成共同的业务逻辑
- 聚合的对外接口人。即聚合之间通过聚合根ID关联引用，如果想访问其他聚合体，首先要访问其聚合根。



# 笔记摘抄

聚合有一个聚合根和上下文边界，这个边界根据业务**单一职责**和**高内聚**原则，定义了聚合内部应该包含哪些实体和值对象，而聚合之间的边界是**松耦合**(可以理解为尽量减少耦合)的。

聚合根的主要目的是为了避免复杂数据模型缺少统一的业务规则控制，而导致聚合、实体之间数据不一致的问题。





# 总结思考

## 实体中的唯一标志符

实体拥有唯一的标志符，且其标识符在不随着自身属性改变而改变。这里的唯一标志符是方便在实体随着各种状态变更后容易标志区分而引入，并不是因为对象有了唯一标志符而被称为实体，需要特别注意其因果关系。



## 聚合的设计原则

1. 在一致性边界内建模真正的不变条件。聚合用来封装真正的不变性，而不是简单地将对象组合在一起。聚合内有一套不变的业务规则，各实体和值对象按照统一的业务规则运行，实现对象数据的一致性，边界之外的任何东西都与该聚合无关，这就是聚合能实现业务高内聚的原因。
2. 设计小聚合。如果聚合设计得过大，聚合会因为包含过多的实体，导致实体之间的管理过于复杂，高频操作时会出现并发冲突和数据库锁，最终导致系统可用性变差。而小聚合设计则可以降低由于业务过大导致聚合重构的可能性，让领域模型更能适应业务的变化。
3. 通用唯一标志引用其他聚合。减少聚合之间的耦合度。
4. 在边界之外使用最终一致性。聚合内数据强一致性，而聚合之间数据最终一致性。在一次事务中，最多只能更改一个聚合的状态。如果设计多个聚合状态，应采用领域事件的方式异步修改相关的聚合。
5. 通过应用实现跨聚合的服务调用。为实现微服务内聚合之间的解耦，以及未来以聚合为单位的微服务组合和拆分，应避免跨聚合的领域服务调用和跨聚合的数据库表关联。



